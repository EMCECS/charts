suite: test decks
templates:
  - webdav-deployment.yaml
tests:
  - it: should create a deployment
    asserts:
    - isKind:
        of: Deployment
  - it: should have a default image
    set:
      image.pullPolicy: Always
    asserts:
    - equal:
        path: spec.template.spec.containers[0].image
        value: emccorp/decks-webdav:2.4
    - equal:
        path: spec.template.spec.containers[0].imagePullPolicy
        value: Always
  - it: should have name ending with webdav
    asserts:
    - matchRegex:
        path: metadata.name
        pattern: ^decks-webdav$
  - it: should have a name label
    asserts:
    - equal:
        path: spec.template.metadata.labels.name
        pattern: ^decks-webdav$
  - it: should configure a webdav container with all params
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: AUTH_TYPE
            value: Digest
  - it: should configure a webdav container with port
    set:
      webdav.containerPort: 80
    asserts:
      - contains:
          path: spec.template.spec.containers[0].ports
          content:
            containerPort: 80