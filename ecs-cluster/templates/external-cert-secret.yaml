---
{{- if eq .Values.s3.tls.certificateType "ExternallySigned" }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-s3-tls
  annotations:
    "helm.sh/hook": "pre-install"
    "helm.sh/hook-delete-policy": "before-hook-creation"
    "certificateType": "EXternallySigned"
  labels:
    app.kubernetes.io/component: {{ .Release.Name }}-s3 
    app.kubernetes.io/name: {{.Release.Name}}
    app.kubernetes.io/version: {{.Values.tag}}
    app.kubernetes.io/instance: {{.Release.Name}}
    app.kubernetes.io/managed-by: {{.Release.Service}}
    helm.sh/chart: {{.Chart.Name}}-{{.Chart.Version | replace "+" "_"}}
    product: objectscale
    release: {{ .Release.Name }}
  namespace: {{ .Release.Namespace}}
stringData: 
  tls.crt: |-
{{ required "server side certificate is required to create tls secrets" .Values.s3.tls.certificate.publicKey |indent 4}}
{{- with .Values.s3.tls.certificate }}
{{- if and .authority .authority.intermediateCA }}
{{ .authority.intermediateCA |indent 4}}
{{- end }}
{{- if and .authority .authority.rootCA }}
{{ .authority.rootCA |indent 4}}
{{- end }}
{{- end }}
  tls.key: |-
{{required "server side private key is required to create tls secrets" .Values.s3.tls.certificate.privateKey|indent 4 }}
{{- end }}
---
{{- if eq .Values.managementGateway.tls.certificateType "ExternallySigned" }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-management-gateway-tls
  annotations:
    "helm.sh/hook": "pre-install"
    "helm.sh/hook-delete-policy": "before-hook-creation"
    "certificateType": "EXternallySigned"
  labels:
    app.kubernetes.io/component: {{ .Release.Name }}-management-gateway
    app.kubernetes.io/name: {{.Release.Name}}
    app.kubernetes.io/version: {{.Values.tag}}
    app.kubernetes.io/instance: {{.Release.Name}}
    app.kubernetes.io/managed-by: {{.Release.Service}}
    helm.sh/chart: {{.Chart.Name}}-{{.Chart.Version | replace "+" "_"}}
    product: objectscale
    release: {{ .Release.Name }}
  namespace: {{ .Release.Namespace}}
stringData: 
  tls.crt: |-
{{ required "server side certificate is required to create tls secrets" .Values.managementGateway.tls.certificate.publicKey |indent 4}}
{{- with .Values.managementGateway.tls.certificate }}
{{- if and . .authority .authority.intermediateCA}}
{{ .authority.intermediateCA |indent 4}}
{{- end }}
{{- if and .authority .authority.rootCA }}
{{ .authority.rootCA |indent 4}}
{{- end }}
{{- end }}
  tls.key: |-
{{required "server side private key is required to create tls secrets" .Values.managementGateway.tls.certificate.privateKey|indent 4 }}
{{- end }}
