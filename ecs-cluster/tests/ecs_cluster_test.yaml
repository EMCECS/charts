suite: test ecs-cluster resource
templates:
  - ecs_cluster.yaml
tests:
  - it: should create a custom resource
    asserts:
      - isKind:
          of: ECSCluster
  - it: should have a default log agent image
    asserts:
    - equal:
        path: spec.syslogAgent.image.repository
        value: emccorp/rsyslog
    - equal:
        path: spec.syslogAgent.image.tag
        value: 0.1.5
    - equal:
        path: spec.syslogAgent.image.pullPolicy
        value: Always
  - it: should customize the log agent
    set:
      global.registry: my-registry
      syslogAgent.image.repository: my-log-agent
      syslogAgent.image.tag: latest
      syslogAgent.image.pullPolicy: IfNotPresent
    asserts:
      - equal:
          path: spec.syslogAgent.image.repository
          value: my-registry/my-log-agent
      - equal:
          path: spec.syslogAgent.image.tag
          value: latest
      - equal:
          path: spec.syslogAgent.image.pullPolicy
          value: IfNotPresent
  - it: should customize the storage storage
    set:
      global.registry: my-registry
      storageServer.image.repository: my-ss
      storageServer.image.tag: latest
      storageServer.image.pullPolicy: IfNotPresent
    asserts:
    - equal:
        path: spec.storageServer.image.repository
        value: my-registry/my-ss
    - equal:
        path: spec.storageServer.image.tag
        value: latest
    - equal:
        path: spec.storageServer.image.pullPolicy
        value: IfNotPresent
