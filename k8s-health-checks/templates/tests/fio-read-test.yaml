apiVersion: v1
kind: Pod
metadata:
  name: {{ .Release.Name }}-fio-test
  labels:
    release: {{ .Release.Name }}
  namespace: {{ .Release.Namespace}}
  annotations:
    "helm.sh/hook": test-success
spec:
    containers:
      - name: {{ .Release.Name }}-fio-test
        image: datawiseio/fio:latest
        volumeMounts:
          - name: {{ .Release.Name }}-fio-test
            mountPath: /data
        command: ["/bin/sh", "-c"]
        args: ["/usr/bin/fio --name=k8sfio
                --rw={{ .Values.fioReadTestPara.rw }}
                --numjobs={{ .Values.fioReadTestPara.numjobs }}
                --iodepth={{ .Values.fioReadTestPara.iodepth }}
                --filesize={{ .Values.fioReadTestPara.filesize }}
                --runtime={{ .Values.fioReadTestPara.runtime }}
                --time_based
                --filename_format=fio-$jobnum
                --directory=/data/
                --output-format=json
                --output=/data/fio.out"]
        env:
          - name: NODE_NAME
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
    volumes:
      - name: {{ .Release.Name }}-fio-test
        hostPath:
            path: /data/FIO
    restartPolicy: Never