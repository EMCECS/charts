apiVersion: v1
kind: Pod
metadata:
  name: {{ .Release.Name }}-fio-test
  labels:
    release: {{ .Release.Name }}
  namespace: {{ .Release.Namespace}}
  annotations:
    "helm.sh/hook": test-success
spec:
    containers:
      - name: {{ .Release.Name }}-fio-test
        image: kimixu/alpine-fio:v0.1
        imagePullPolicy: Always
        volumeMounts:
          - name: {{ .Release.Name }}-fio-test
            mountPath: /data
          - name: {{ .Release.Name }}-fio-config-volume
            mountPath: /etc/config
        command: ["/bin/sh", "-c"]
        args: ["/usr/local/bin/fio /etc/config/ecs.fio
              --output-format=json
              --output=/data/fio.out;"]
    volumes:
      - name: {{ .Release.Name }}-fio-test
        hostPath:
            path: /data/FIO
      - name: {{ .Release.Name }}-fio-config-volume
        configMap:
          name: fio-config
    restartPolicy: Never