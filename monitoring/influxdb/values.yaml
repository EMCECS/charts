---
#
# Copyright Â© [2020] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#

# Default values for ecs-flex.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# These global settings relate to Monitoring
global:
  # Name of a Kubernetes secret with Docker credentials for the private registry
  registrySecret: dockerhub-registry-secret

  # The private docker registry hosting containers for ECS Flex
  # registry: harbor.lss.emc.com/ecs
  registry: emccorp

  # Default: "" == Watch ALL namespaces
  watchNamespace: ""

  tls_enabled: true

  internal_dns: kube-dns.kube-system.svc.cluster.local

  performanceProfile: "Small"
  started: true


disable_recovery: false

persistence:
  storageClassName: "baremetal-csi-sc-ssdlvg"
  enabled: true
  accessMode: ReadWriteOnce
  size: 20Gi

# Docker repository to be used for influxdb instances
image:
  repository: influxdb
  pullPolicy: IfNotPresent

## Configure resource requests and limits
## ref: http://kubernetes.io/docs/user-guide/compute-resources/
resources:
  requests: {}
  limits: {}

## Customize livenessProbe and readinessProbe
## ref: https://docs.influxdata.com/influxdb/v1.7/tools/api/#ping-http-endpoint
##
livenessProbe:
  probePath: "/ping"

readinessProbe:
  probePath: "/ping"

startupProbe:
  enabled: false
  probePath: "/ping"
  # failureThreshold: 6
  # periodSeconds: 5

## Specify a service type
## NodePort is default
## ref: http://kubernetes.io/docs/user-guide/services/
##
service:
  ## Add annotations to service
  # annotations: {}
  type: ClusterIP
  clusterIP: None
  bind_address: 8086
  rpc:
    bind_address: 8088

## Change InfluxDB configuration parameters below:
## Defaults are indicated
## ref: https://docs.influxdata.com/influxdb/v1.7/administration/config
config:
  reporting_disabled: true
  storage_directory: /data/influxdb
  rpc:
    enabled: true
    # redefine to 18088 when tls is enabled
    bind_address: 8088
  meta:
    retention_autocreate: true
    logging_enabled: true
  data:
    query_log_enabled: true
    cache_max_memory_size: 1073741824
    cache_snapshot_memory_size: 26214400
    cache_snapshot_write_cold_duration: 10m0s
    compact_full_write_cold_duration: 4h0m0s
    max_series_per_database: 1000000
    max_values_per_tag: 100000
    index_version: tsi1
    trace_logging_enabled: false
  coordinator:
    write_timeout: 10s
    max_concurrent_queries: 0
    query_timeout: 0s
    log_queries_after: 0s
    max_select_point: 0
    max_select_series: 0
    max_select_buckets: 0
  retention:
    enabled: true
    check_interval: 30m0s
  shard_precreation:
    enabled: true
    check_interval: 10m0s
    advance_period: 30m0s
  admin:
    enabled: false
    bind_address: 8083
    https_enabled: false
    https_certificate: /etc/ssl/influxdb.pem
  monitor:
    store_enabled: false
    store_database: _internal
    store_interval: 10s
  subscriber:
    enabled: true
    http_timeout: 30s
    insecure_skip_verify: false
    ca_certs: ""
    write_concurrency: 40
    write_buffer_size: 1000
  http:
    enabled: true
    # redefine to 18086 when tls is enabled
    bind_address: 8086
    auth_enabled: false
    flux_enabled: true
    log_enabled: true
    write_tracing: false
    pprof_enabled: true
    https_enabled: false
    https_certificate: /etc/ssl/influxdb.pem
    https_private_key: ""
    max_row_limit: 10000
    max_connection_limit: 0
    shared_secret: "beetlejuicebeetlejuicebeetlejuice"
    realm: InfluxDB
    unix_socket_enabled: false
    bind_socket: /var/run/influxdb.sock
  logging:
    format: auto
    level: info
    supress_logo: false

initScripts:
  enabled: true
  scripts:
    init.iql: |+
      CREATE DATABASE "monitoring_main" WITH DURATION 60d SHARD DURATION 10d NAME "default"
      CREATE DATABASE "monitoring_op" WITH DURATION 5d SHARD DURATION 5d NAME "default"
      CREATE DATABASE "monitoring_last" WITH DURATION 1d SHARD DURATION 1d NAME "default"
      CREATE DATABASE "monitoring_vdc" WITH DURATION 60d SHARD DURATION 10d NAME "default"
      CREATE DATABASE "monitoring_meta" WITH DURATION 60d SHARD DURATION 10d NAME "default"
      CREATE DATABASE "monitoring_rt" WITH DURATION 1h SHARD DURATION 1h NAME "default"
