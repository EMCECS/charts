#
# Copyright Â© [2020] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#

# Alert definitions for Platform monitoring
prometheus-alerts:
  config:
    alerts:
      - id: "XDR_ECS_RAP071"
        enabled: true
        range: 1h
        reason: "Hardware failure in the CPU chipset or motherboard."
        message: "RAP071 - Detected a CPU core {{ $labels.cpu }} running under({{ $value }}MHz) the configured MHz({{ $labels.min_freq }}) threshold on host {{ $labels.host }}"
        symptoms:
          - id: XDR_ECS_RAP071
            types:
              - Error
            event_rule:
              description: "RAP071 - Detected a CPU core running under the configured MHz threshold"
              notifiers:
                - objectscale-srs
            event_remedy:
              description: "RAP071 - Detected a CPU core running under the configured MHz threshold"
              remedies:
                - KB 520958
      - id: "FD_2050"
        enabled: true
        range: 1h
        reason: "One or more processes have a large amount of open files that is causing the node to approach the maximum number of open file descriptors allowed"
        message: "Number of open file descriptors is above threshold. Node: {{ $labels.host }}"
        symptoms:
          - id: 2050
            types:
              - Warning
              - Error
              - Critical
            event_rule:
              description: "Number of open file descriptors is above threshold"
              notifiers:
                - objectscale-srs
            event_remedy:
              description: Number of open file descriptors is above threshold
              remedies:
                - KB 531531
      - id: "DM_2029"
        enabled: true
        range: 1h
        reason: "A defect in Docker 1.9.1 where large amounts of standard out while in a Docker Container causes the Docker PID to grow and not release memory"
        message: "Docker Memory over threshold 8GB on node {{ $labels.host }}"
        symptoms:
          - id: 2029
            types:
              - Critical
            event_rule:
              description: "Docker Memory over threshold on one or more nodes"
              notifiers:
                - objectscale-srs
            event_remedy:
              description: "Docker Memory over threshold on one or more nodes"
              remedies:
                - KB 498131
      - id: "FS_2042"
        enabled: true
        range: 1h
        reason: "Filesystem mounted by /var path has large files or docker volumes consume a lot of space"
        message: "Thresholds exceeded, usable space {{ $value }}GB on root fs are less than threshold on node {{ $labels.host }}"
        symptoms:
          - id: 2039
            types:
              - Warning
            event_rule:
              description: "Thresholds exceeded, usable space on root fs are less than threshold"
              notifiers:
                - objectscale-srs
            event_remedy:
              description: "Thresholds exceeded, usable space on root fs are less than threshold"
              remedies:
                - KB 537017
          - id: 2042
            types:
              - Error
            event_rule:
              description: "Thresholds exceeded, usable space on root fs are less than threshold"
              notifiers:
                - objectscale-srs
            event_remedy:
              description: "Thresholds exceeded, usable space on root fs are less than threshold"
              remedies:
                - KB 537017
      - id: "CUP_4001"
        enabled: true
        range: 1h
        reason: "If CPU usage percent crosses the threshold specified then the alert is triggered."
        message: "CPU usage is {{ $value }} % crosses threshold on host {{ $labels.host }}"
        symptoms:
          - id: 4001
            types:
              - Warning
            event_rule:
              description: "CPU usage crosses threshold."
              notifiers:
                - objectscale-srs
            event_remedy:
              description: "CPU usage crosses threshold."
              remedies:
                - KB 536054
          - id: 4002
            types:
              - Error
            event_rule:
              description: "CPU usage crosses threshold."
              notifiers:
                - objectscale-srs
            event_remedy:
              description: "CPU usage crosses threshold."
              remedies:
                - KB 536054
          - id: 4003
            types:
              - Critical
            event_rule:
              description: "CPU usage crosses threshold."
              notifiers:
                - objectscale-srs
            event_remedy:
              description: "CPU usage crosses threshold."
              remedies:
                - KB 536054
      - id: "MH_4019"
        enabled: true
        range: 30m
        reason: "No data is pushed to the monitoring framework for the last 30 minutes from a particular node"
        message: "Data recorded in TSDB is lagging by 30 mins on node {{ $labels.host }}"
        symptoms:
          - id: 4019
            types:
              - Critical
            event_rule:
              description: "Data recorded in TSDB is lagging by 30 mins on a particular node"
              notifiers:
                - objectscale-srs
            event_remedy:
              description: "Data recorded in TSDB is lagging by 30 mins on a particular node"
              remedies:
                - KB 536249
