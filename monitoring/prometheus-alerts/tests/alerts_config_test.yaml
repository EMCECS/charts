#
# Copyright Â© [2020] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#

suite: test alert rules configmap
templates:
  - alerts_config.yaml
tests:
  - it: alerter enabled
    set:
      config:
        dir: "alerts/test"
        component: "test_component"
        alerts:
          - id: "test_1"
            enabled: true
            range: 1h
            message: "msg_1"
            reason: "reason_1"
            symptoms:
              - id: 111
                types:
                  - Warning
              - id: 112
                types:
                  - Critical
          - id: "test_2"
            enabled: true
            range: 5m
            message: "msg_2"
            reason: "reason_2"
            symptoms:
              - id: 222
                types:
                  - Error
                  - Warning
                  - Critical
          - id: "test_3"
            enabled: false
            range: 5m
            message: "msg_3"
            reason: "reason_3"
            symptoms:
              - id: 333
                types:
                  - Error
    asserts:
      - equal:
          path: data.alerts\.yaml
          value: |-
            groups:
              - name: "test_component"
                rules:
                  - alert: "test_1"
                    range: 1h
                    expr: |-
                      test_1
                    annotations:
                      reason: "reason_1"
                      message: "msg_1"
                    symptoms:
                      - id: 111
                        types:
                          - Warning
                      - id: 112
                        types:
                          - Critical
                  - alert: "test_2"
                    range: 5m
                    expr: |-
                      test_2
                    annotations:
                      reason: "reason_2"
                      message: "msg_2"
                    symptoms:
                      - id: 222
                        types:
                          - Error
                          - Warning
                          - Critical
      - isNotNull:
          path: data.process\.tmpl
