[
  {
    "template":"requests.tmpl",
    "min-depth":"5m",
    "max-depth":"4h",
    "max-age": "1440h",
    "start-offset": "-30m",
    "keep-offset": "20m",
    "target":"cq_performance_transaction",

    "value-columns":["failed_request_counter","succeed_request_counter"],
    "tag-columns":null,
    "params":{
      "comment":"min-depth values in all performance CQs are set to 30m to ensure that derivative()/difference() functions work correctly with possible data loss cases",
      "measurement":"statDataHead_performance_internal_transactions"
    },
    "max-retry": 3
  },
  {
    "template":"requests-delta.tmpl",
    "min-depth":"5m",
    "max-depth":"4h",
    "start-offset": "-30m",
    "keep-offset": "20m",
    "max-age": "1440h",
    "target":"cq_performance_transaction_delta",

    "value-columns":["failed_request_counter_i","succeed_request_counter_i"],
    "tag-columns":null,
    "params":{
      "comment":"generates delta values while other cqs generate rates. delta are needed for total table",
      "measurement":"statDataHead_performance_internal_transactions",
      "column_rename":"failed_request_counter: \"failed_request_counter_i\", succeed_request_counter: \"succeed_request_counter_i\""
    },
    "max-retry": 3
  },
  {
    "template":"requests-delta.tmpl",
    "min-depth":"5m",
    "max-depth":"4h",
    "start-offset": "-30m",
    "keep-offset": "20m",
    "max-age": "1440h",
    "target":"cq_performance_error_delta",

    "value-columns":["user_errors_i","system_errors_i"],
    "tag-columns":null,
    "params":{
      "measurement":"statDataHead_performance_internal_error",
      "column_rename":"user_errors: \"user_errors_i\", system_errors: \"system_errors_i\""
    },
    "max-retry": 3
  },
  {
    "template":"requests.tmpl",
    "min-depth":"5m",
    "max-depth":"4h",
    "start-offset": "-30m",
    "keep-offset": "20m",
    "max-age": "1440h",
    "target":"cq_performance_throughput",

    "value-columns":["total_read_requests_size","total_write_requests_size"],
    "tag-columns":null,
    "params":{
      "measurement":"statDataHead_performance_internal_throughput"
    },
    "max-retry": 3
  },
  {
    "template":"requests.tmpl",
    "min-depth":"5m",
    "max-depth":"4h",
    "start-offset": "-30m",
    "keep-offset": "20m",
    "max-age": "1440h",
    "target":"cq_performance_error",

    "value-columns":["user_errors","system_errors"],
    "tag-columns":null,
    "params":{
      "measurement":"statDataHead_performance_internal_error"
    },
    "max-retry": 3
  },
  {
    "template":"latency.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset": "-30m",
    "keep-offset": "20m",
    "max-age": "1440h",
    "target":"cq_performance_latency",

    "value-columns":["p50","p99"],
    "tag-columns":["id"],
    "params":{
      "measurement":"statDataHead_performance_internal_latency"
    },
    "max-retry": 3,
    "sync-query": true
  },
  {
    "template":"capacity-disks-free.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target":"cq_capacity_disks_free",
    "value-columns":["freeSpace"],
    "tag-columns":["SS", "PD", "SSTableLevel"],
    "max-retry": 3,
    "sync-query": true
  },
  {
    "template":"capacity-disks-total.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target":"cq_capacity_disks_total",
    "value-columns":["totalSpace"],
    "tag-columns":["SS", "PD", "SSTableLevel"],
    "max-retry": 3,
    "sync-query": true
  },
  {
    "template":"disk-state.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target":"cq_disk_state",
    "value-columns":["hwState"],
    "tag-columns":["SS", "PD"],
    "max-retry": 3,
    "sync-query": true
  },
  {
    "template":"ss-state.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target":"cq_ss_state",
    "value-columns":["SSState"],
    "tag-columns":["SS"],
    "max-retry": 3,
    "sync-query": true
  },
  {
    "template":"capacity-nodes.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-1h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target":"cq_capacity_nodes",
    "value-columns":["total_i", "totalL1", "totalL2", "used", "usedL1", "usedL2","available", "availableL1", "availableL2","reserved","offline"],
    "tag-columns":["_host_id"],
    "max-retry": 3,
    "sync-query": true,
    "depend-on": ["cq_ss_state", "cq_disk_state", "cq_capacity_disks_free", "cq_capacity_disks_total"]
  },
  {
    "template":"capacity-vdc.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-1h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target":"cq_capacity_vdc",
    "value-columns":["total_i","used","available","reserved", "offline"],
    "max-retry": 3,
    "sync-query": true,
    "depend-on": ["cq_capacity_nodes"]
  },
  {
    "template":"recover-status-summary.tmpl",
    "type": "downsampling",
    "min-depth":"5m",
    "max-depth":"24h",
    "start-offset":"-12h",
    "keep-offset":"715m",
    "max-age":"1440h",
    "target":"cq_recover_status_summary",
    "value-columns":["data_to_recover", "data_recovered"],
    "tag-columns":null,
    "max-retry": 3,
    "depend-on": ["cq_total_cm_Recover_Statistics"],
    "sync-query": true
  },
  {
    "template":"node-rebalancing.tmpl",
    "type": "downsampling",
    "min-depth":"5m",
    "max-depth":"24h",
    "start-offset":"-12h",
    "keep-offset":"715m",
    "max-age":"1440h",
    "target":"cq_node_rebalancing_summary",
    "value-columns":["data_rebalanced", "pending_rebalance"],
    "depend-on": ["cq_total_cm_Rebalance_Statistics"],
    "sync-query": true
  },
  {
    "template":"capacity-ec.tmpl",
    "type": "downsampling",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"0s",
    "keep-offset":"0s",
    "max-age":"1440h",
    "target":"cq_capacity_ec",
    "value-columns":["total_coded_data", "total_coding_data"],
    "tag-columns":null,
    "max-retry": 3,
    "depend-on": ["cq_total_cm_Chunk_Statistics", "cq_total_cm_EC_Statistics"],
    "sync-query": true
  },
  {
    "template":"capacity-ec-rate.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-1h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target":"cq_capacity_ec_rate",
    "value-columns":["coding_rate"],
    "max-retry": 3,
    "sync-query": true
  },
  {
    "template":"disk-bandwidth.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-1h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target":"cq_disk_bandwidth",
    "value-columns":["total", "consistency_checker", "erasure_encoding", "geo", "hardware_recovery", "user_traffic", "xor"],
    "tag-columns":["type_op"],
    "max-retry": 3,
    "sync-query": true
  },
  {
    "template": "gc-stats.tmpl",
    "type": "downsampling",
    "min-depth": "5m",
    "max-depth": "1h",
    "start-offset": "0s",
    "keep-offset": "0s",
    "max-age":"1440h",
    "target":"cq_gc_data",
    "value-columns":["user_gc_pending", "user_gc_unreclaim", "system_gc_pending", "system_gc_unreclaim","system_gc_reclaimed","user_gc_reclaimed"],
    "tag-columns":null,
    "max-retry": 3,
    "depend-on": ["cq_total_cm_REPO_GC_Statistics", "cq_total_cm_BTREE_GC_Statistics", "cq_total_sr_REPO_GC_Statistics"],
    "sync-query": true
  },
  {
    "template":"capacity-used-elements.tmpl",
    "type": "downsampling",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"0s",
    "keep-offset":"0s",
    "max-age":"1440h",
    "target":"cq_capacity_used_elements",
    "value-columns":["user_data", "meta_data", "protection_overhead_wo_geo"],
    "tag-columns":null,
    "max-retry": 3,
    "depend-on": ["cq_total_cm_Chunk_Statistics", "cq_total_cm_EC_Statistics"],
    "sync-query": true
  },
  {
    "template":"hardware-health-nodes-counters.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"24h",
    "target":"cq_hardware_health_nodes_counter",
    "value-columns":["good_nodes", "bad_nodes", "maintenance_nodes"],
    "max-retry": 3,
    "sync-query": true
  },
  {
    "template":"hardware-health-disks-counters.tmpl",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"24h",
    "target":"cq_hardware_health_disks_counter",
    "value-columns":["good_disks", "bad_disks", "maintenance_disks"],
    "max-retry": 3,
    "sync-query": true
  },
  {
    "comment":"******************************* DOWNSAMPLE CQs *******************************",
    "template":"downsample.tmpl",
    "type": "downsampling",
    "min-depth":"24h",
    "max-depth":"24h",
    "start-offset": "0s",
    "keep-offset": "0s",
    "max-age": "1440h",
    "target":"cq_performance_transaction_downsampled",
    "value-columns":["failed_request_counter","succeed_request_counter"],
    "tag-columns":null,
    "depend-on": ["cq_performance_transaction"],
    "params":{
      "measurement":"cq_performance_transaction",
      "aggregation":"mean"
    },
    "max-retry": 3
  },
  {
    "template":"downsample.tmpl",
    "type": "downsampling",
    "min-depth":"24h",
    "max-depth":"24h",
    "start-offset": "0s",
    "keep-offset": "0s",
    "max-age": "1440h",
    "target":"cq_performance_transaction_delta_downsampled",
    "value-columns":["failed_request_counter_i","succeed_request_counter_i"],
    "tag-columns":null,
    "depend-on": ["cq_performance_transaction_delta"],
    "params":{
      "measurement":"cq_performance_transaction_delta",
      "aggregation":"sum"
    },
    "max-retry": 3
  },
  {
    "template":"downsample.tmpl",
    "type": "downsampling",
    "min-depth":"24h",
    "max-depth":"24h",
    "start-offset": "0s",
    "keep-offset": "0s",
    "max-age": "1440h",
    "target":"cq_performance_error_delta_downsampled",
    "value-columns":["user_errors_i","system_errors_i"],
    "tag-columns":null,
    "depend-on": ["cq_performance_error_delta"],
    "params":{
      "measurement":"cq_performance_error_delta",
      "aggregation":"sum"
    },
    "max-retry": 3
  },
  {
    "template":"downsample.tmpl",
    "type": "downsampling",
    "min-depth":"24h",
    "max-depth":"24h",
    "start-offset": "0s",
    "keep-offset": "0s",
    "max-age": "1440h",
    "target":"cq_performance_throughput_downsampled",
    "value-columns":["total_read_requests_size","total_write_requests_size"],
    "tag-columns":null,
    "depend-on": ["cq_performance_throughput"],
    "params":{
      "measurement":"cq_performance_throughput",
      "aggregation":"mean"
    },
    "max-retry": 3
  },
  {
    "template":"downsample.tmpl",
    "type": "downsampling",
    "min-depth":"24h",
    "max-depth":"24h",
    "start-offset": "0s",
    "keep-offset": "0s",
    "max-age": "1440h",
    "target":"cq_performance_error_downsampled",
    "value-columns":["user_errors","system_errors"],
    "tag-columns":null,
    "depend-on": ["cq_performance_error"],
    "params":{
      "measurement":"cq_performance_error",
      "aggregation":"mean"
    },
    "max-retry": 3
  },
  {
    "template":"downsample.tmpl",
    "type": "downsampling",
    "min-depth":"24h",
    "max-depth":"24h",
    "start-offset": "0s",
    "keep-offset": "0s",
    "max-age": "1440h",
    "target":"cq_performance_latency_downsampled",
    "value-columns":["p50","p99"],
    "tag-columns":["id"],
    "depend-on": ["cq_performance_latency"],
    "params":{
      "measurement":"cq_performance_latency",
      "aggregation":"mean"
    },
    "max-retry": 3
  },
  {
    "comment":"********************************** Total CQs **********************************",
    "template":"total.tmpl",
    "type":"downsampling",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target": "cq_total_cm_Chunk_Statistics",
    "value-columns": ["chunks_copy_active", "chunks_copy", "chunks_copy_s0", "chunks_xor", "chunks_repo_active",
      "chunks_repo", "chunks_repo_s0", "chunks_level_0_btree_s0", "chunks_level_1_btree_s0", "chunks_level_0_journal_s0",
      "chunks_level_1_journal_s0", "chunks_level_0_btree_active", "chunks_level_1_btree_active", "chunks_level_0_journal_active",
      "chunks_level_1_journal_active", "chunks_level_0_btree", "chunks_level_1_btree", "chunks_level_0_journal", "chunks_level_1_journal" ,
      "chunks_typeI_ec_pending", "chunks_typeII_ec_pending", "chunks_undertransform_ec_pending", "data_repo", "data_copy", "data_xor", "data_level_0_btree"],
    "tag-columns": null,
    "max-retry": 3,
    "sync-query": true,
    "dependent-intervals": true,
    "params": {
      "database": "monitoring_main",
      "measurement": "cm_Chunk_Statistics"
    }
  },
  {
    "template":"total.tmpl",
    "type":"downsampling",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target": "cq_total_cm_REPO_GC_Statistics",
    "value-columns": ["deleted_chunks_repo", "ec_freed_slots", "slots_waiting_shipping", "full_reclaimable_aligned_chunk"],
    "tag-columns":null,
    "max-retry": 3,
    "sync-query": true,
    "dependent-intervals": true,
    "params": {
      "database": "monitoring_main",
      "measurement": "cm_REPO_GC_Statistics"
    }
  },
  {
    "template":"total.tmpl",
    "type":"downsampling",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target": "cq_total_cm_BTREE_GC_Statistics",
    "value-columns": ["deleted_chunks_btree_level_0", "deleted_chunks_btree_level_1",
      "verification_waiting_chunks_btree_gc_level_0", "verification_waiting_chunks_btree_gc_level_1",
      "candidate_chunks_btree_gc_level_0", "candidate_chunks_btree_gc_level_1"],
    "tag-columns":null,
    "max-retry": 3,
    "sync-query": true,
    "dependent-intervals": true,
    "params": {
      "database": "monitoring_main",
      "measurement": "cm_BTREE_GC_Statistics"
    }
  },
  {
    "template":"total.tmpl",
    "type":"downsampling",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target": "cq_total_sr_REPO_GC_Statistics",
    "value-columns": ["full_reclaimable_repo_chunk", "total_repo_garbage"],
    "tag-columns":null,
    "max-retry": 3,
    "sync-query": true,
    "dependent-intervals": true,
    "params": {
      "database": "monitoring_main",
      "measurement": "sr_REPO_GC_Statistics"
    }
  },
  {
    "template":"total.tmpl",
    "type":"downsampling",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target": "cq_total_cm_EC_Statistics",
    "value-columns": ["chunks_ec_encoded_alive", "data_ec_encoded_alive"],
    "tag-columns":null,
    "max-retry": 3,
    "sync-query": true,
    "dependent-intervals": true,
    "params": {
      "database": "monitoring_main",
      "measurement": "cm_EC_Statistics"
    }
  },
  {
    "template":"total.tmpl",
    "type":"downsampling",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target": "cq_total_cm_Recover_Statistics",
    "value-columns": ["data_to_recover", "data_recovered"],
    "tag-columns":null,
    "max-retry": 3,
    "sync-query": true,
    "dependent-intervals": true,
    "params": {
      "database": "monitoring_main",
      "measurement": "cm_Recover_Statistics"
    }
  },
  {
    "template":"total.tmpl",
    "type":"downsampling",
    "min-depth":"5m",
    "max-depth":"1h",
    "start-offset":"-12h",
    "keep-offset":"0m",
    "max-age":"1440h",
    "target": "cq_total_cm_Rebalance_Statistics",
    "value-columns": ["bytes_rebalanced", "segments_for_rebalancing", "segments_rebalanced", "segments_rebalancing_failed"],
    "tag-columns":null,
    "max-retry": 3,
    "sync-query": true,
    "dependent-intervals": true,
    "params": {
      "database": "monitoring_main",
      "measurement": "cm_Rebalance_Statistics"
    }
  }
]
