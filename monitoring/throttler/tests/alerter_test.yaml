#
# Copyright Â© [2020] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#

suite: test alerter configmap
templates:
  - alerter.yaml
tests:
  - it: alerter disabled
    set:
      config.alerter.enabled: false
    asserts:
      - hasDocuments:
          count: 0
  - it: alerter enabled
    set:
      config:
        alerter:
          enabled: true
          dir: "test_alert"
          component: "test_component"
          alerts:
            - id: "test_1"
              enabled: true
              range: 1h
              symptoms:
                - id: 111
                  types:
                    - Warning
                - id: 112
                  types:
                    - Critical
            - id: "test_2"
              enabled: false
              range: 5m
              symptoms:
                - id: 222
                  types:
                    - Error
                    - Warning
                    - Critical
    asserts:
      - equal:
          path: data.alerts\.yaml
          value: |-
            alerts:
              - id: test_1
                enabled: true
                application: RELEASE-NAME-throttler
                component: test_component
                range: 1h
                query_path: alert_test_1.flux
                symptoms:
                  - id: 111
                    types:
                      - Warning
                  - id: 112
                    types:
                      - Critical
              - id: test_2
                enabled: false
                application: RELEASE-NAME-throttler
                component: test_component
                range: 5m
                query_path: alert_test_2.flux
                symptoms:
                  - id: 222
                    types:
                      - Error
                      - Warning
                      - Critical
      - isNotNull:
          path: data.alert_test_1\.flux
      - isNotNull:
          path: data.alert_test_2\.flux
