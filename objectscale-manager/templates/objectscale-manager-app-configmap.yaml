---
apiVersion: v1
kind: ConfigMap
metadata:
    name: objectscale-manager-app-config
    namespace: {{.Release.Namespace}}
    labels:
      app.kubernetes.io/name: objectscale-manager
      app.kubernetes.io/instance: {{ .Release.Name }}
      app.kubernetes.io/managed-by: {{ .Release.Service }}
      app.kubernetes.io/version: {{ .Chart.AppVersion }}
      app.kubernetes.io/part-of: {{ .Release.Name }}
      helm.sh/chart: {{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}
      release: {{ .Release.Name}}
      operator: objectscale-operator
      product: objectscale
    annotations:
        com.dellemc.kahm.subscribed: "true"
data:
    eventRules: |-
    healthAndReports: |-
      spec:
        - name: pre-update
          container: {{.Values.global.registry}}/objectscale-manager-pre-update:{{.Values.tag}}
          serviceaccount: {{ .Release.Name }}-healthchecks
          timelimit: "5m"
          args:
            - -target-version
            - {{ default .Values.tag .Values.healthChecks.preUpdate.image.tag}}
        - name: inventory-report 
          container: {{.Values.global.registry}}/objectscale-inventory-report:{{.Values.tag}}
          serviceaccount: {{ .Release.Name }}-inventory-report
          timelimit: "5m"
          schedule: {{ default "0 * * * *" .Values.healthChecksAndReports.inventoryReport.schedule }}
        - name: capacity-report 
          container: {{.Values.global.registry}}/objectscale-capacity-report:{{.Values.tag}}
          serviceaccount: {{ .Release.Name }}-capacity-report
          timelimit: "5m"
          schedule: {{ default "0 * * * *" .Values.healthChecksAndReports.capacityReport.schedule }}
        - name: performance-report 
          container: {{.Values.global.registry}}/objectscale-performance-report:{{.Values.tag}}
          serviceaccount: {{ .Release.Name }}-performance-report
          timelimit: "5m"
          schedule: {{ default "*/5 * * * *" .Values.healthChecksAndReports.performanceReport.schedule }}
        - name: health-report 
          container: {{.Values.global.registry}}/objectscale-health-report:{{.Values.tag}}
          serviceaccount: {{ .Release.Name }}-health-report
          timelimit: "5m"
          schedule: {{ default "*/5 * * * *" .Values.healthChecksAndReports.healthReport.schedule }}
    eventRemedies: |-
      symptoms:
        - symptomid: DEOS-MGR-1001
          description: Provisioning of the new objectstore failed
          remedies:
            - Check the results of the provisioning job
