suite: test api binding
templates:
  - api-binding.yaml
tests:
  - it: should create a cluster role binding
    set:
      VMwarePersistentService: true
    asserts:
      - isKind:
          of: ClusterRoleBinding
  - it: should have a name service-account-objectscale-api
    set:
      VMwarePersistentService: true
    asserts:
      - equal:
          path: metadata.name
          value: service-account-objectscale-api
  - it: should bind to the correct service account
    set:
      VMwarePersistentService: true
    asserts:
      - equal:
          path: subjects[0].name
          value: objectscale-api
  - it: should bind to the correct role
    set:
      VMwarePersistentService: true
    asserts:
      - equal:
          path: roleRef.name
          value: objectscale-admin
