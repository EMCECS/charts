suite: test telemetry cronjob 
templates:
  - telemetry-cronjob.yaml
tests:
  - it: should create a cronjob 
    asserts:
    - isKind:
        of: CronJob 
  - it: should have a default image
    asserts:
    - matchRegex:
        path: spec.jobTemplate.spec.template.spec.containers[0].image
        pattern: emccorp/telemetry-upload:.*
  - it: should have a default pullPolicy
    asserts:
    - equal:
        path: spec.jobTemplate.spec.template.spec.containers[0].imagePullPolicy
        value: IfNotPresent
  - it: should have name objectscale-telemetry
    asserts:
    - equal:
        path: metadata.name
        value: objectscale-telemetry 
  - it: should have a name label
    asserts:
    - equal:
        path: spec.jobTemplate.spec.template.metadata.labels.app\.kubernetes\.io/component
        value: objectscale-telemetry 
        path: spec.jobTemplate.spec.template.metadata.labels.app\.kubernetes\.io/name
        value: objectscale-manager
  - it: should configure the image
    set:
      global.registry: REGISTRY
      telemetry.image.repository: REPO
      telemetry.image.tag: TAG
      telemetry.image.pullPolicy: IfNotPresent
    asserts:
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].image
          value: REGISTRY/REPO:TAG
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].imagePullPolicy
          value: IfNotPresent

