---
apiVersion: v1
kind: ConfigMap
metadata:
    name: supportassist-{{.Values.product}}-app-config
    namespace: {{.Release.namespace}}
    labels:
        app.kubernetes.io/name: supportassist-{{.Values.product}}
        app.kubernetes.io/version: {{.Values.tag}}
        app.kubernetes.io/instance: {{.Release.Name}}
        app.kubernetes.io/managed-by: {{.Release.Service}}
        helm.sh/chart: {{.Chart.Name}}-{{.Chart.Version | replace "+" "_"}}
        release: {{.Release.Name}}
        product: {{.Values.product}}
    annotations:
        com.dellemc.kahm.subscribed: "true"
data:
    eventRules: |-
      issueRules:
       - name: SupportAssistConfiguration
         description: "SupportAssist configuration issues"
         issueCategory: Auto
         matchOnList:
          - matchon:
            - label: SymptomID
              value: DECKS-SA-1023
    eventRemedies: |-
      symptoms:
        - symptomid: DECKS-SA-1023
          description: Dell EMC SupportAssist configuration issues
          remedies:
            - Verify the supportassist-{{.Values.product}} pod is Running
            - Is SupportAssist still disabled?
            - Verify connectivity of configured gateways.
            - Verify a valid AccessKey and PIN were used.
    health: |-
      spec:
        - name: inventory
          container: {{.Values.global.registry}}/telemetry-upload:{{.Values.tag}}
          serviceaccount: {{ .Release.Name }}-telemetry-upload
          timelimit: "5m"
          schedule: {{ default "0 * * * *" .Values.cloudIQ.inventory.schedule }}
          args:
            - -folder
            - {{ .Values.cloudIQ.inventory.folder}}
            - -transferType
            - {{ .Values.cloudIQ.inventory.transferType}}
            - -product
            - {{.Values.product}}
          disabled: {{ default false .values.healthChecks.inventory.disabled }}
        - name: capacity
          container: {{.Values.global.registry}}/telemetry-upload:{{.Values.tag}}
          serviceaccount: {{ .Release.Name }}-telemetry-upload
          timelimit: "5m"
          schedule: {{ default "0 * * * *" .Values.cloudIQ.capacity.schedule }}
          args:
            - -folder
            - {{ .Values.cloudIQ.capacity.folder}}
            - -transferType
            - {{ .Values.cloudIQ.inventory.transferType}}
            - -product
            - {{.Values.product}}
          disabled: {{ default false .values.healthChecks.capacity.disabled }}
        - name: performance
          container: {{.Values.global.registry}}/telemetry-upload:{{.Values.tag}}
          serviceaccount: {{ .Release.Name }}-telemetry-upload
          timelimit: "5m"
          schedule: {{ default "0 * * * *" .Values.cloudIQ.performance.schedule }}
          args:
            - -folder
            - {{ .Values.cloudIQ.performance.folder}}
            - -transferType
            - {{ .Values.cloudIQ.inventory.transferType}}
            - -product
            - {{.Values.product}}
          disabled: {{ default false .values.healthChecks.performance.disabled }}
        - name: health
          container: {{.Values.global.registry}}/telemetry-upload:{{.Values.tag}}
          serviceaccount: {{ .Release.Name }}-telemetry-upload
          timelimit: "5m"
          schedule: {{ default "0 * * * *" .Values.cloudIQ.health.schedule }}
          args:
            - -folder
            - {{ .Values.cloudIQ.health.folder}}
            - -transferType
            - {{ .Values.cloudIQ.inventory.transferType}}
            - -product
            - {{.Values.product}}
          disabled: {{ default false .values.healthChecks.health.disabled }}
